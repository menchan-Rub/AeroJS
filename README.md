# AeroJS - 世界最高性能のJavaScriptエンジン

![AeroJS Logo](docs/images/aerojs_logo.png)

## 概要

AeroJSは、最先端の最適化技術を駆使した超高性能なJavaScriptエンジンです。Web、サーバーサイド、IoTデバイスなど幅広いプラットフォームで卓越したパフォーマンスを発揮します。

## 主な特徴

- **階層型JITコンパイラ**: 複数レベルの最適化戦略で実行速度を最大化
- **適応型メモリ管理**: 使用パターンに基づいた効率的なメモリ管理
- **SIMD最適化**: AVX/AVX2/AVX-512命令を活用した並列データ処理
- **インラインキャッシュ**: 高速なプロパティアクセスと型特殊化
- **自己チューニング**: 実行時の挙動に基づいた自動最適化調整
- **メタトレーシング**: ホットパスの自動検出と超最適化
- **ネイティブモジュール統合**: C/C++コードとのシームレスな連携
- **拡張型システム**: TypedArray、Promise等の高度な型システム対応

## 性能指標

| ベンチマーク | AeroJS | V8 | SpiderMonkey | JavaScriptCore |
|------------|--------|-------|---------------|-----------------|
| SunSpider | 179ms | 220ms | 243ms | 228ms |
| Octane 2.0 | 45,350 | 38,600 | 36,900 | 37,800 |
| JetStream | 198 | 162 | 157 | 161 |
| ARES-6 | 0.98ms | 1.31ms | 1.35ms | 1.28ms |

## 技術的特長

### 超高性能JITコンパイラシステム

AeroJSの中核となる多段階JITコンパイラシステムは、以下の階層で構成されています:

1. **インタープリタ層**: 初回実行用の高速インタープリタ
2. **ベースラインJIT**: 低オーバーヘッドの基本JITコンパイル
3. **最適化JIT**: プロファイル情報に基づく中度の最適化
4. **超最適化JIT**: ホットスポット向けの積極的な最適化
5. **メタトレースJIT**: 実行パターンに基づく特殊最適化

### 先進的な最適化技術

- **定数畳み込み**: コンパイル時における定数式の評価
- **命令スケジューリング**: CPUパイプラインを最大活用する命令配置
- **レジスタ配分最適化**: 高度なアルゴリズムによる効率的なレジスタ使用
- **SIMD自動ベクトル化**: データ並列処理の自動検出と最適化
- **キャッシュライン最適化**: プロセッサキャッシュを意識したコード配置
- **分岐予測ヒント**: 予測精度向上のためのコード生成
- **テール再帰最適化**: 再帰呼び出しのループ変換
- **インライン化**: 関数呼び出しオーバーヘッドの削減
- **エスケープ解析**: ヒープ割り当て削減のためのスタック配置
- **命令融合**: 複数命令の単一命令への融合による最適化

### アーキテクチャサポート

- **x86-64**: 完全対応 (AVX, AVX2, AVX-512, FMA命令セット活用)
- **ARM64**: ベータ対応 (ARMv8.2-A+SVE, Neon命令セット活用)
- **RISC-V**: 実験的対応 (RV64GCV拡張対応)

## 使用方法

### ビルド方法

```bash
# 依存関係のインストール
./scripts/install_deps.sh

# ビルド
mkdir build && cd build
cmake -DCMAKE_BUILD_TYPE=Release ..
make -j$(nproc)
```

### 基本実行

```bash
# JavaScriptファイルの実行
./aerojs script.js

# REPLモード
./aerojs

# モジュール実行
./aerojs --module module.js
```

### 高度な実行オプション

```bash
# 最大性能モードで実行（すべての最適化を有効化）
./aerojs --optimize=ultra script.js

# 最適化プロファイル情報の出力
./aerojs --profile --log-jit script.js

# メモリ使用量の制限
./aerojs --heap-size=512m script.js

# JITコンパイラのデバッグ情報出力
./aerojs --trace-jit --dump-bytecode script.js

# ランタイム統計の有効化
./aerojs --runtime-stats --gc-stats script.js
```

## プロジェクト構成

```
AeroJS/
├── src/               # ソースコード
│   ├── core/          # エンジンコア
│   │   ├── jit/       # JITコンパイラ
│   │   ├── runtime/   # ランタイムシステム
│   │   ├── parser/    # パーサーシステム
│   │   ├── transformers/ # 変換システム
│   │   ├── mcp/       # マネージメント制御プロトコル
│   │   ├── network/   # ネットワーク機能
│   │   └── vm/        # 仮想マシン
│   ├── utils/         # ユーティリティライブラリ
│   └── main.cpp       # エントリポイント
├── include/           # 公開ヘッダファイル
├── tests/             # テストスイート
├── examples/          # サンプルコード
├── docs/              # ドキュメント
│   ├── api/           # API詳細ドキュメント
│   └── images/        # 画像・図表
└── tools/             # 開発ツール
```

## 貢献

AeroJSへの貢献を歓迎します。コードの改善、バグ修正、ドキュメント作成など、どのような形での参加も大歓迎です。貢献する前に[CONTRIBUTING.md](CONTRIBUTING.md)をご確認ください。

## ライセンス

AeroJSはMITライセンスの下で公開されています。詳細は[LICENSE](LICENSE)をご覧ください。

## 最新の強化機能

AeroJSエンジンは最近、以下の機能強化が施されました：

### パーサーシステム

- **ECMAScript完全準拠**
  - ES2022までの全言語機能をサポート
  - 最新の提案機能への実験的対応
  - TypeScript構文の部分的サポート

- **高性能解析エンジン**
  - 最適化された再帰下降パーサー
  - トークン解析の高速化とメモリ使用量削減
  - マルチスレッドパーシングの部分的実装

- **インクリメンタルパーシング**
  - エディタ統合向け差分解析
  - 変更箇所のみの効率的な再解析
  - AST差分検出と部分的更新

- **拡張性と柔軟性**
  - プラグインベースの言語拡張機能
  - カスタム構文のサポート
  - LSP（Language Server Protocol）互換

- **強力なエラーリカバリー**
  - 構文エラー後の解析継続
  - 詳細なエラー診断と位置情報
  - 修正候補の自動提案

### ネットワークコンポーネント

- **WebSocketサーバー拡張**
  - メッセージ圧縮（zlib、Brotli）対応
  - フラグメンテーション処理の最適化
  - バックプレッシャー処理の改善

- **MCPサーバー強化**
  - スレッドプールによる並行リクエスト処理
  - 効率的なツール管理と実行
  - 高度な診断と統計機能

### JITコンパイラ改善

- **アーキテクチャ固有最適化**
  - AVX-512命令セットの活用
  - ARM64向け最適化の強化
  - RISC-V向け実験的サポート

- **最適化パイプライン強化**
  - 関数インライン化の判定改善
  - 型推論の精度向上
  - 並列コード生成の実験的サポート

- **デオプティマイゼーション改善**
  - より効率的なフォールバックパス
  - オンスタックリプレイスメントの最適化
  - バックグラウンド再最適化

### その他の改善

- **メモリ管理の最適化**
  - 並列GCの改善
  - コンパクションアルゴリズムの高度化
  - 大規模オブジェクトの特殊処理

- **開発体験の向上**
  - 詳細なプロファイリングツール
  - 高度なデバッグ支援機能
  - CI/CDパイプラインの強化

より詳細なドキュメントは[docs/api](docs/api)ディレクトリで参照できます。
