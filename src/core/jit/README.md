# AeroJS JITコンパイルシステム

## 概要

AeroJS JavaScriptエンジンの超高性能JITコンパイルシステムの実装です。複数階層の最適化戦略と収集型プロファイラーを用いて、JavaScript実行のパフォーマンスを最大限に引き出します。

## アーキテクチャ

JITシステムは以下の主要コンポーネントで構成されています：

1. **JITコンパイラー階層**
   - **BaselineJIT**: 低レイテンシの初期コンパイルを提供
   - **OptimizingJIT**: プロファイル情報に基づく中程度の最適化
   - **SuperOptimizingJIT**: 高頻度実行コードに対する積極的な最適化
   - **TieredJIT**: 上記を統合し、実行頻度に応じた段階的最適化を提供

2. **プロファイラー**
   - コードの実行パターンを収集し、最適化のヒントを提供
   - 型情報、実行頻度、分岐バイアスなどのデータを記録
   - 統計ベースの最適化判断をサポート

3. **IR (中間表現)システム**
   - **IRBuilder**: バイトコードからIRへの変換
   - **IROptimizer**: 複数レベルの最適化パスを提供（定数畳み込み、デッドコード除去など）

4. **バックエンド**
   - **x86_64コードジェネレーター**: x86_64アーキテクチャ向けの機械語生成
   - **ARM64コードジェネレーター**: ARM64アーキテクチャ向けの機械語生成（将来実装）
   - **RISC-Vコードジェネレーター**: RISC-Vアーキテクチャ向けの機械語生成（将来実装）

5. **デオプティマイザー**
   - 最適化コードからインタープリターへの退避機構
   - 型安定性が崩れた場合などに安全に実行を続行

6. **コードキャッシュ**
   - コンパイル済みコードをキャッシュし、再コンパイルを回避
   - ハッシュベースの高速ルックアップ

## 最適化戦略

1. **ベースライン最適化**
   - 高速なコンパイル
   - シンプルな最適化のみ

2. **標準最適化**
   - 定数畳み込み
   - デッドコード除去
   - 共通部分式の除去
   - 命令の組み合わせ最適化

3. **積極的最適化**
   - 型特化
   - インライン展開
   - ループ最適化
   - SIMD命令の活用

## フロー

1. JavaScript関数が呼び出されると、バイトコードはまずBaselineJITでコンパイルされる
2. 実行中にプロファイル情報が収集される
3. 関数が「ホット」と判断されると、バックグラウンドで最適化JITコンパイルが実行される
4. 最適化コードが生成されるとコードキャッシュに格納され、次回実行時に使用される
5. 型安定性が崩れた場合、デオプティマイザーによりインタープリターへフォールバック

## 拡張

将来的な拡張計画：

1. より高度なループ最適化（ループアンロールなど）
2. 並列JITコンパイル
3. 型推論システムの強化
4. WebAssemblyへの最適化対応
5. ハードウェア特化最適化（AVX-512、SVE）

## 構成ディレクトリ

- `baseline/`: ベースラインJIT実装
- `optimizing/`: 最適化JITおよび超最適化JIT実装
- `ir/`: 中間表現システム
- `profiler/`: 実行プロファイラー
- `backend/`: コード生成バックエンド
- `deoptimizer/`: 最適化解除機構 